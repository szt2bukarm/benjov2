{"version":3,"file":"index.modern.js","sources":["../src/index.js"],"sourcesContent":["import React, { useEffect, useRef, useCallback, useContext } from \"react\";\r\nimport useResizeObserver from '@react-hook/resize-observer'; \r\n\r\nconst Heaven = React.createContext()\r\nconst clamp = value => Math.max(Math.min(value, 1), 0)\r\n\r\n/**\r\n * A React hook to access the current scoll value and delta\r\n * \r\n * @returns Object { delta: 0, scroll: 0 }\r\n */\r\nexport const useHeaven = () => useContext(Heaven)\r\n\r\n/**\r\n *  A React context provider that enables smooth scroll on its children.\r\n *\r\n *  @param style        Style object to overide the default styling of the parent element.\r\n *  @param disable      Whether or not the scroll effect will be enabled.\r\n *  @param velocity     A value from 0 to 1 that determines the strength of the effect.\r\n *  @param rootId       The id of the root component to hard set the height.\r\n *  @param resetHeight  An array of dependencies to listen for height resetting.\r\n */\r\nconst HeavenScroll = ({ children, style={}, resetHeight=[], disable=false, velocity=0.1, rootId='root' }) => {\r\n    const scrollableContainerRef = useRef(null)\r\n    const SCROLL_ID = useRef(null)\r\n\r\n    const {current: config} = useRef({ velocity: clamp(velocity), current: 0, previous: 0, requestScrollEvent: 0 })\r\n    const {current: heaven} = useRef({ delta: 0, scroll: 0 })\r\n\r\n    const setScrollerHeight = () => {\r\n        const { height } = scrollableContainerRef.current.getBoundingClientRect()\r\n        document.getElementById(rootId).style.height = `${height}px`\r\n    }\r\n\r\n    useResizeObserver( scrollableContainerRef, setScrollerHeight )\r\n\r\n    const smoothScrollingHandler = useCallback(() => {\r\n        config.current = window.scrollY\r\n        const DELTA_SCROLL = (config.current - config.previous) * config.velocity\r\n\r\n        config.previous += DELTA_SCROLL\r\n\r\n        if (Math.abs(config.current - config.previous) < 0.05) {\r\n            config.previous = config.current\r\n            config.requestScrollEvent = 0\r\n        }\r\n\r\n        heaven.delta  = DELTA_SCROLL\r\n        heaven.scroll = config.previous + DELTA_SCROLL\r\n\r\n        scrollableContainerRef.current.style.transform = `matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, -${config.previous}, 0, 1)`\r\n\r\n        SCROLL_ID.current = config.requestScrollEvent > 0 ? requestAnimationFrame(smoothScrollingHandler) : null\r\n    }, [SCROLL_ID])\r\n\r\n    const scrollHandler = useCallback(() => {\r\n        config.requestScrollEvent++;\r\n        if (!SCROLL_ID.current) SCROLL_ID.current = requestAnimationFrame(smoothScrollingHandler)\r\n    }, [SCROLL_ID, smoothScrollingHandler])\r\n\r\n    useEffect(() => {\r\n        if (disable) return\r\n\r\n        window.addEventListener('scroll', scrollHandler)\r\n        return () => window.removeEventListener('scroll', scrollHandler)\r\n    }, [disable, scrollHandler]);\r\n\r\n    useEffect(() => {\r\n        if (disable) return \r\n\r\n        setScrollerHeight()\r\n        return () => document.getElementById('root').removeAttribute('style')\r\n    }, [disable, ...resetHeight])\r\n\r\n    return disable ? children : (\r\n        <Heaven.Provider value={heaven}>\r\n            <div style={{ position: 'fixed', overflow: 'hidden', height: '100%', width: '100%', ...style }}>\r\n                <main id=\"scrollableContainer\" ref={scrollableContainerRef} style={{ willChange: \"transform\" }}>{children}</main>\r\n            </div>\r\n        </Heaven.Provider>\r\n    )\r\n}\r\n\r\nexport default HeavenScroll"],"names":["Heaven","React","createContext","clamp","value","Math","max","min","useHeaven","useContext","HeavenScroll","_ref","children","_ref$style","style","_ref$resetHeight","resetHeight","_ref$disable","disable","_ref$velocity","velocity","_ref$rootId","rootId","scrollableContainerRef","useRef","SCROLL_ID","_useRef","current","previous","requestScrollEvent","config","_useRef2","delta","scroll","heaven","setScrollerHeight","_scrollableContainerR","getBoundingClientRect","height","document","getElementById","useResizeObserver","smoothScrollingHandler","useCallback","window","scrollY","DELTA_SCROLL","abs","transform","requestAnimationFrame","scrollHandler","useEffect","addEventListener","removeEventListener","removeAttribute","concat","createElement","Provider","_extends","position","overflow","width","id","ref","willChange"],"mappings":"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"}